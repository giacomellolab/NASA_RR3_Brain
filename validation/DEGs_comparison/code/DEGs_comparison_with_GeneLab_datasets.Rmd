---
title: "DEGs_comparison_snclusters"
author: "Yuvarani Masarapu"
date: "2023-10-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Read the 825 DEGs from the multiomics clusters
```{r}
library(readxl)
degs <- read_excel("Supplementary_Table_3.xlsx", 
    skip = 1)
```

Add expression labels 'upregulated' or 'downregulated' based on positive or negative logFC values for each gene
```{r}
degs$logFC <- as.numeric(degs$logFC)

degs$expression_label <- ifelse(degs$logFC>=0, "upregulated", "downregulated")
```

# Read the 11 NASA Genelab datasets used in the comparison analysis mentioned in the study

* Combine them in one big dataframe format for comparison
* We use a p-value of 0.05 to filter the genes. Same p-value was used in the RR3 ST and multiomics brain data analysis. Then label the gene as upregulated or downregulated
* These datasets can be downloaded from the NASA OSDR website and the files are also provided in the **/data/other_datasets** folder to access.

## RR1 eye GLDS 100
```{r}
library(readr)
RR1_eye_GLDS100 <- read_csv("other_datasets/RR1_eye_GLDS100/GLDS-100_rna_seq_differential_expression.csv")

RR1_eye_GLDS100 <- RR1_eye_GLDS100[RR1_eye_GLDS100$`P.value_(Space Flight)v(Ground Control)`<0.05, ] #2686 genes with P-value less than 0.05

RR1_eye_GLDS100$expression_lbl <- ifelse(RR1_eye_GLDS100$`Log2fc_(Space Flight)v(Ground Control)`>=0, "upregulated", "downregulated")

overlap1 <- unique(intersect(degs$Gene, RR1_eye_GLDS100$SYMBOL))
```

## RR1 gastro musc GLDS 101
```{r}
library(readr)
RR1_gastro_GLDS101 <- read_csv("other_datasets/RR1_gastro-musc_GLDS101/GLDS-101_rna_seq_differential_expression.csv")

RR1_gastro_GLDS101 <- RR1_gastro_GLDS101[RR1_gastro_GLDS101$`P.value_(FLT)v(GC)`<0.05, ] #1865 genes with P-value less than 0.05

RR1_gastro_GLDS101$expression_lbl <- ifelse(RR1_gastro_GLDS101$`Log2fc_(FLT)v(GC)`>=0, "upregulated", "downregulated")

overlap2 <- unique(intersect(degs$Gene, RR1_gastro_GLDS101$SYMBOL))
```

## RR1 kidney GLDS 102
```{r}
library(readr)
RR1_kidney_GLDS102 <- read_csv("other_datasets/RR1_kidney_GLDS102/GLDS-102_rna_seq_differential_expression.csv")

RR1_kidney_GLDS102 <- RR1_kidney_GLDS102[RR1_kidney_GLDS102$`P.value_(Space Flight)v(Ground Control)`<0.05, ] #2322 genes with P-value less than 0.05

RR1_kidney_GLDS102$expression_lbl <- ifelse(RR1_kidney_GLDS102$`Log2fc_(Space Flight)v(Ground Control)`>=0, "upregulated", "downregulated")

overlap3 <- unique(intersect(degs$Gene, RR1_kidney_GLDS102$SYMBOL))
```

## RR1 liver GLDS 47
```{r}
library(readr)
RR1_liver_GLDS47 <- read_csv("other_datasets/RR1_liver_GLDS47/GLDS-47_rna_seq_differential_expression.csv")

RR1_liver_GLDS47 <- RR1_liver_GLDS47[RR1_liver_GLDS47$`P.value_(Space Flight)v(Ground Control)`<0.05, ] #1198 genes with P-value less than 0.05

RR1_liver_GLDS47$expression_lbl <- ifelse(RR1_liver_GLDS47$`Log2fc_(Space Flight)v(Ground Control)`>=0, "upregulated", "downregulated")

overlap4 <- unique(intersect(degs$Gene, RR1_liver_GLDS47$SYMBOL))
```

## RR1 quad musc GLDS 103
```{r}
library(readr)
RR1_quad_musc_GLDS103 <- read_csv("other_datasets/RR1_quad-musc_GLDS103/GLDS-103_rna_seq_differential_expression.csv")

RR1_quad_musc_GLDS103 <- RR1_quad_musc_GLDS103[RR1_quad_musc_GLDS103$`P.value_(Space Flight)v(Ground Control)`<0.05, ] #3185 genes with P-value less than 0.05

RR1_quad_musc_GLDS103$expression_lbl <- ifelse(RR1_quad_musc_GLDS103$`Log2fc_(Space Flight)v(Ground Control)`>=0, "upregulated", "downregulated")

overlap5 <- unique(intersect(degs$Gene, RR1_quad_musc_GLDS103$SYMBOL))
```

## RR1 soleus musc GLDS 104
```{r}
library(readr)
RR1_soleus_musc_GLDS104 <- read_csv("other_datasets/RR1_soleus-musc_GLDS104/GLDS-104_rna_seq_differential_expression.csv")

RR1_soleus_musc_GLDS104 <- RR1_soleus_musc_GLDS104[RR1_soleus_musc_GLDS104$`P.value_(FLT)v(GC)`<0.05, ] #6871 genes with P-value less than 0.05

RR1_soleus_musc_GLDS104$expression_lbl <- ifelse(RR1_soleus_musc_GLDS104$`Log2fc_(FLT)v(GC)`>=0, "upregulated", "downregulated")

overlap6 <- unique(intersect(degs$Gene, RR1_soleus_musc_GLDS104$SYMBOL))
```

## RR1 tib ant musc GLDS 105
```{r}
library(readr)
RR1_tib_ant_musc_GLDS105 <- read_csv("other_datasets/RR1_tib-ant-musc_GLDS105/GLDS-105_rna_seq_differential_expression.csv")

RR1_tib_ant_musc_GLDS105 <- RR1_tib_ant_musc_GLDS105[RR1_tib_ant_musc_GLDS105$`P.value_(FLT)v(GC)`<0.05, ] #3319 genes with P-value less than 0.05

RR1_tib_ant_musc_GLDS105$expression_lbl <- ifelse(RR1_tib_ant_musc_GLDS105$`Log2fc_(FLT)v(GC)`>=0, "upregulated", "downregulated")

overlap7 <- unique(intersect(degs$Gene, RR1_tib_ant_musc_GLDS105$SYMBOL))
```

## RR3 adrenal GLDS 161
```{r}
library(readr)
RR3_adrenal_GLDS161 <- read_csv("other_datasets/RR3_adrenal_GLDS161/GLDS-161_rna_seq_differential_expression.csv")

RR3_adrenal_GLDS161 <- RR3_adrenal_GLDS161[RR3_adrenal_GLDS161$`P.value_(Space Flight)v(Ground Control)`<0.05, ] #908 genes with P-value less than 0.05

RR3_adrenal_GLDS161$expression_lbl <- ifelse(RR3_adrenal_GLDS161$`Log2fc_(Space Flight)v(Ground Control)`>=0, "upregulated", "downregulated")

overlap8 <- unique(intersect(degs$Gene, RR3_adrenal_GLDS161$SYMBOL))
```

## RR3 eye GLDS 162
```{r}
library(readr)
RR3_eye_GLDS162 <- read_csv("other_datasets/RR3_eye_GLDS162/GLDS-162_rna_seq_differential_expression.csv")

RR3_eye_GLDS162 <- RR3_eye_GLDS162[RR3_eye_GLDS162$`P.value_(Space Flight)v(Ground Control)`<0.05, ] #1870 genes with P-value less than 0.05

RR3_eye_GLDS162$expression_lbl <- ifelse(RR3_eye_GLDS162$`Log2fc_(Space Flight)v(Ground Control)`>=0, "upregulated", "downregulated")

overlap9 <- unique(intersect(degs$Gene, RR3_eye_GLDS162$SYMBOL))
```

## RR3 kidney GLDS 163
```{r}
library(readr)
RR3_kidney_GLDS163 <- read_csv("other_datasets/RR3_kidney_GLDS163/GLDS-163_rna_seq_differential_expression.csv")

RR3_kidney_GLDS163 <- RR3_kidney_GLDS163[RR3_kidney_GLDS163$`P.value_(Space Flight)v(Ground Control)`<0.05, ] #3084 genes with P-value less than 0.05

RR3_kidney_GLDS163$expression_lbl <- ifelse(RR3_kidney_GLDS163$`Log2fc_(Space Flight)v(Ground Control)`>=0, "upregulated", "downregulated")

overlap10 <- unique(intersect(degs$Gene, RR3_kidney_GLDS163$SYMBOL))
```

## RR3 liver GLDS 168
```{r}
library(readr)
RR3_liver_GLDS168 <- read_csv("other_datasets/RR3_liver_GLDS168/GLDS-168_rna_seq_differential_expression.csv")

RR3_liver_GLDS168 <- RR3_liver_GLDS168[RR3_liver_GLDS168$`P.value_(RR3_FLT_wERCC)v(RR3_GC_wERCC)`<0.05, ] # 978 genes with P-value less than 0.05

RR3_liver_GLDS168$expression_lbl <- ifelse(RR3_liver_GLDS168$`Log2fc_(RR3_FLT_wERCC)v(RR3_GC_wERCC)`>=0, "upregulated", "downregulated")

overlap11 <- unique(intersect(degs$Gene, RR3_liver_GLDS168$SYMBOL))
```

# Find Overlap across all datasets
```{r}
common.all <- intersect(overlap1, intersect(overlap2, intersect(overlap3, intersect(overlap4, intersect(overlap5, intersect(overlap6, intersect(overlap7, intersect(overlap8, (intersect(overlap9, intersect(overlap10, overlap11)))))))))))

overlap.all <- union(overlap1, union(overlap2, union(overlap3, union(overlap4, union(overlap5, union(overlap6, union(overlap7, union(overlap8, (union(overlap9, union(overlap10, overlap11)))))))))))
overlap.all <- unique(overlap.all)
```

# Put data in 1 single excel file
```{r}
df <- data.frame()
df <- data.frame("Mission" = c("RR1", "RR1", "RR1", "RR1", "RR1", "RR1", "RR1", "RR3", "RR3", "RR3", "RR3"), 
                 "Organ" = c("Eye", "Gastrocnemius Muscle", "Kidney", "Liver", "Quadriceps Muscle", "Soleus Muscle", "Tibialis Anterior Muscle", "Adrenal Gland", "Eye", "Kidney", "Liver"),
                 "Overlapping_Spaceflight_multiomics_genes" = c(toString(overlap1), toString(overlap2), toString(overlap3), toString(overlap4), toString(overlap5), toString(overlap6), toString(overlap7), toString(overlap8), toString(overlap9), toString(overlap10), toString(overlap11)))

writexl::write_xlsx(df, path = "Supplementary_Table_5.xlsx", col_names = TRUE)
```

